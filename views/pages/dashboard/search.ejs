
<body>
    <section>
        <div class="row">
            <div class="col-md-8 left-container" style="padding-top: 2em;">
                <!--paginate.ejs-->
                <div class="row">
                <% for (let i = 0; i < ads.length; i++) { %>
                    <div class="card col-md-4">
                        <img class="card-img-top" src="<%= imgs[i].url %>" alt="Card image cap"  
                        style="display: none; width: 100%; height: 15vw; object-fit: cover;" onload="this.style.display='';document.getElementById('loading').style.display='none'" onerror="tryAgain(this)"/>
                        <div class="card-body">
                            <div class="card-title">
                                <a href="/ads/adDetails/<%= ads[i].id %>">
                                    <%= ads[i].title %></a>
                            </div>
                            <p class="card-text"><%= ads[i].jobType %></p>
                            <time class="card-text"><%= ads[i].createdAt %></time>
                            <p class="card-text" ><%= ads[i].adType %> (for testing ONLY)</p>
                        </div>
                        </div>
                <% }; %>
                </div>
            </div>

            <div class="col-md-4 right-container card" style="padding: 5em 2em; background-color:#F1F6F5;">
                <h1 style="text-align: center;">Search</h1>
                <hr>
                <form action="/searchResult" method="POST">
                    <div class="row" style="padding: 1em 1em;">
                        <div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text"><i class="fa fa-key"></i></span>
							</div>
							<input type="text" name="title" class="form-control" placeholder="Keywords Search...">
						</div>
                    </div>

                    <div class="row" style="padding: 1em 1em;">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupSelect01"><i class="fa fa-user"></i></label>
                            </div>
                            <select class="browser-default custom-select" id="adType" name="adType">
                                <option selected value="">Finding...</option>
                                <option value="Job">Job</option>
                                <option value="Availability">Canadidate</option>
                            </select>
                            </div>
                    </div>

                    <div class="row" style="padding: 1em 1em;">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupSelect01"><i class="fa fa-calendar" aria-hidden="true"></i></label>
                            </div>
                            <select class="browser-default custom-select" id="scheduleOptions" name="scheduleOptions">
                                <option selected value="">Schedule...</option>
                                <option value="Regular">Regular</option>
                                <option value="One-off">One-off</option>
                            </select>
                        </div>
                    </div>

                    <div class="row" style="padding: 1em 1em;">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupSelect01">Care Types</label>
                            </div>
                            <select class="browser-default custom-select" id="jobType" name="jobType">
                                <option selected value="">Choose...</option>
                                <option value="Elderly Care">Elderly Care</option>
                                <option value="Child Care">Child Care</option>
                                <option value="Medical Care">Medical Care</option>
                                <option value="Personal Care">Personal Care</option>
                                <option value="HouseKeeper">HouseKeeper</option>
                            </select>
                        </div>
                    </div>

                    <div class="row" style="padding: 1em 1em;">
                        <input type="hidden" name="_csrf" id="_csrf" value="<%- _csrf %>" />
                        <button type="submit" class="btn btn-info wrn-btn" style="margin-left: auto;">Search <span class="fa fa-search" aria-hidden="true"></span></button>
                    </div>
                </form>
            </div>
        </div>

        <nav aria-label="Page navigation" style="padding: 1em 0;">
            <ul class="pagination justify-content-center">
                <li class="page-item"><a class="page-link" href="#" id="firstLink"><i class="fa fa-angle-double-left"></i></a></li>
                <li class="page-item" id="previousParent">
                    <a class="page-link" id="previousButton"><i class="fa fa-angle-left"></i></a>
                </li>
                <li class="page-item"><a class="page-link" href="#" id="previousLink">2</a></li>
                <li class="page-item active"><a class="page-link" href="#" id="currentLink">3</a></li>
                <li class="page-item"><a class="page-link" href="#" id="nextLink">4</a></li>
                <li class="page-item" id="nextParent">
                    <a class="page-link" id="nextButton"><i class="fa fa-angle-right"></i></a>
                </li>
                <li class="page-item"><a class="page-link" href="#" id="lastLink"><i class="fa fa-angle-double-right"></i></a></li>
            </ul>
        </nav>

    </section>

</body>
<script>
    function buildLinks() {

        var previousButton = document.getElementById("previousButton");
        var nextButton = document.getElementById("nextButton");
        var currentLink = document.getElementById("currentLink");
        var previousLink = document.getElementById("previousLink");
        var nextLink = document.getElementById("nextLink");
        var firstLink = document.getElementById("firstLink");
        var lastLink = document.getElementById("lastLink");

        var total = parseInt("<%= total %>");
        var perPage = Math.max(parseInt("<%= req.query.perPage %>"), 6) || 6;
        var current = Math.max(parseInt("<%= req.query.current %>"), 1) || 1;

        var baseUrl = "/search?perPage=" + perPage + "&current=";

        firstLink.href = baseUrl + 1;
        previousButton.href = baseUrl + (current - 1);
        previousLink.href = baseUrl + (current - 1);
        currentLink.href = baseUrl + current;
        nextLink.href = baseUrl + (current + 1);
        nextButton.href = baseUrl + (current + 1);
        lastLink.href = baseUrl + Math.ceil(total / perPage);

        previousLink.innerHTML = current - 1;
        currentLink.innerHTML = current;
        nextLink.innerHTML = current + 1;
        // lastLink.innerHTML = Math.ceil(total / perPage); 

        if (current <= 1) {
            // previousButton.setAttribute("disabled", true);
            document.getElementById("previousParent").classList.add("disabled");
            previousButton.href = "";
            previousLink.style.display = "none";
        }
        // else{
        //     alert("touch 1")
        //     lastLink.style.display = "none";
        //     firstLink.innerText = "First Page";
        //     firstLink.style.display = "";
        // }

        if (current >= Math.ceil(total / perPage)) {
            // nextButton.setAttribute("disabled", true);
            document.getElementById("nextParent").classList.add("disabled");
            nextButton.href = "";
            nextLink.style.display = "none";
        }
        // else{
        //     alert("touch 2")
        //     firstLink.style.display = "none";
        //     lastLink.innerText = "Last Page";
        //     lastLink.style.display = "";
        // }
    }

    buildLinks();

</script>
<script>
    function tryAgain(e) 
    {
    setTimeout(reloadImg, 1000, e);
    }

    function reloadImg(e)
    {
    var source = e.src;
    e.src = source;
    }
</script>